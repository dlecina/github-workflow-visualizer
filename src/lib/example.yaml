# .github/workflows/example.yml

name: CI/CD Example Workflow

# Controls when the workflow will run
on:
  push:
    branches:
      - main # Run on pushes to the main branch
  pull_request:
    branches:
      - main # Run on pull requests targeting the main branch

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # Job 1: Build
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - name: Checkout Repository
        uses: actions/checkout@v4

      # Example: Setup Node.js (you might use different setup actions for other languages)
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18' # Specify the Node.js version

      # Example: Install dependencies
      - name: Install Dependencies
        run: npm install

      # Example: Build the project
      - name: Build Project
        run: npm run build

      # Conditional Step: This step will only run if the current branch is 'main'
      - name: Publish Build Artifact (Main Branch Only)
        if: github.ref == 'refs/heads/main'
        run: echo "Publishing build artifact for main branch..."
        # In a real scenario, you'd use actions/upload-artifact here
        # uses: actions/upload-artifact@v4
        # with:
        #   name: my-app-build
        #   path: ./dist # Assuming your build output is in a 'dist' folder

      # Another conditional step: This step will only run if the event is a pull_request
      - name: Notify on Pull Request
        if: github.event_name == 'pull_request'
        run: echo "This is a pull request build. No artifact publishing."

  # Job 2: Test
  test:
    # This job depends on the 'build' job. It will only run after 'build' completes successfully.
    needs: build
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install Dependencies
        run: npm install

      # Example: Run tests
      - name: Run Tests
        run: npm test

  # Job 3: Deploy
  deploy:
    # This job depends on the 'test' job. It will only run after 'test' completes successfully.
    needs: test
    runs-on: ubuntu-latest

    # Conditional Job: This entire job will only run if the event is a 'push' to the 'main' branch
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      # Example: Configure AWS credentials (replace with your actual deployment setup)
      - name: Configure AWS Credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: us-east-1

      # Example: Deploy to S3
      - name: Deploy to S3
        run: |
          echo "Deploying application to S3..."
          # aws s3 sync ./dist s3://your-s3-bucket-name --delete
          echo "Deployment complete."
